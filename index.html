<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="海盗船长的领域">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="海盗船长的领域">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蒲建飞">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>海盗船长的领域</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">海盗船长的领域</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">下一个ONE PIECE是这吗？</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/12/windows10%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E5%88%B0Internet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/12/windows10%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E5%88%B0Internet/" class="post-title-link" itemprop="url">windows10无法连接到Internet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-10-12 10:21:23 / 修改时间：10:34:26" itemprop="dateCreated datePublished" datetime="2021-10-12T10:21:23+08:00">2021-10-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="windows10无法连接到Internet"><a href="#windows10无法连接到Internet" class="headerlink" title="windows10无法连接到Internet"></a>windows10无法连接到Internet</h1><h2 id="window10能够上网，但右下角却显示无法连接到Internet，导致WiFi无法开启。-这是window10更新的锅。"><a href="#window10能够上网，但右下角却显示无法连接到Internet，导致WiFi无法开启。-这是window10更新的锅。" class="headerlink" title="window10能够上网，但右下角却显示无法连接到Internet，导致WiFi无法开启。 这是window10更新的锅。"></a>window10能够上网，但右下角却显示无法连接到Internet，导致WiFi无法开启。 这是window10更新的锅。</h2><ul>
<li><p>解决方案：更改注册文件，在桌面创建TXT文件，书写以下代码，后改变后缀名为 .reg。再执行该文件。重启。</p>
<p>  Windows Registry Editor Version 5.00</p>
<p>  [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet]<br>  “ActiveDnsProbeContent”=”131.107.255.255”<br>  “ActiveDnsProbeContentV6”=”fd3e:4f5a:5b81::1”<br>  “ActiveDnsProbeHost”=”dns.msftncsi.com”<br>  “ActiveDnsProbeHostV6”=”dns.msftncsi.com”<br>  “ActiveWebProbeContent”=”Microsoft NCSI”<br>  “ActiveWebProbeContentV6”=”Microsoft NCSI”<br>  “ActiveWebProbeHost”=”<a target="_blank" rel="noopener" href="http://www.msftncsi.com&quot;/">www.msftncsi.com&quot;</a><br>  “ActiveWebProbeHostV6”=”ipv6.msftncsi.com”<br>  “ActiveWebProbePath”=”ncsi.txt”<br>  “ActiveWebProbePathV6”=”ncsi.txt”<br>  “EnableActiveProbing”=dword:00000001<br>  “PassivePollPeriod”=dword:0000000f<br>  “StaleThreshold”=dword:0000001e<br>  “WebTimeout”=dword:00000023</p>
<p>  [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet\ManualProxies]</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/pytorch%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/02/pytorch%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/" class="post-title-link" itemprop="url">pytorch使用心得</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-02 15:42:32" itemprop="dateCreated datePublished" datetime="2021-09-02T15:42:32+08:00">2021-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-13 18:52:14" itemprop="dateModified" datetime="2021-09-13T18:52:14+08:00">2021-09-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pytorch使用诸多问题"><a href="#pytorch使用诸多问题" class="headerlink" title="pytorch使用诸多问题"></a>pytorch使用诸多问题</h1><h2 id="model-train-model-eval-torch-no-grad"><a href="#model-train-model-eval-torch-no-grad" class="headerlink" title="model.train()      model.eval()     torch.no_grad()"></a>model.train()      model.eval()     torch.no_grad()</h2><h3 id="model-train"><a href="#model-train" class="headerlink" title="model.train()"></a>model.train()</h3><ul>
<li><p>启用 Batch Normalization 和 Dropout。<br>如果模型中有BN层(Batch Normalization）和 Dropout，需要在训练时添加model.train()。model.train()是保证BN层能够用到每一批数据的均值和方差。对于Dropout，model.train()是随机取一部分网络连接来训练更新参数.</p>
<h3 id="model-eval"><a href="#model-eval" class="headerlink" title="model.eval()"></a>model.eval()</h3></li>
<li><p>不启用 Batch Normalization 和 Dropout。<br>如果模型中有BN层(Batch Normalization）和Dropout，在测试时添加model.eval()。model.eval()是保证BN层能够用全部训练数据的均值和方差，即测试过程中要保证BN层的均值和方差不变。对于Dropout，model.eval()是利用到了所有网络连接，即不进行随机舍弃神经元。<br>训练完train样本后，生成的模型model要用来测试样本。在model(test)之前，需要加上model.eval()，否则的话，有输入数据，即使不训练，它也会改变权值。这是model中含有BN层和Dropout所带来的的性质。</p>
<h3 id="model-eval-和torch-no-grad-的区别"><a href="#model-eval-和torch-no-grad-的区别" class="headerlink" title="model.eval()和torch.no_grad()的区别"></a>model.eval()和torch.no_grad()的区别</h3></li>
<li><p>在PyTorch中进行validation/test时，会使用model.eval()切换到测试模式，在该模式下：</p>
</li>
<li><p>主要用于通知dropout层和BN层在training和validation/test模式间切换：<br>在train模式下，dropout网络层会按照设定的参数p，设置保留激活单元的概率（保留概率=p)。BN层会继续计算数据的mean和var等参数并更新。<br>在eval模式下，dropout层会让所有的激活单元都通过，而BN层会停止计算和更新mean和var，直接使用在训练阶段已经学出的mean和var值。<br>eval模式不会影响各层的gradient计算行为，即gradient计算和存储与training模式一样，只是不进行反向传播（back probagation)。</p>
</li>
<li><p>而with torch.no_grad()则主要是用于停止autograd模块的工作，以起到加速和节省显存的作用。它的作用是将该with语句包裹起来的部分停止梯度的更新，从而节省了GPU算力和显存，但是并不会影响dropout和BN层的行为。<br>如果不在意显存大小和计算时间的话，仅仅使用model.eval()已足够得到正确的validation/test的结果；而with torch.no_grad()则是更进一步加速和节省gpu空间（因为不用计算和存储梯度），从而可以更快计算，也可以跑更大的batch来测试。</p>
</li>
</ul>
<h2 id="torch-squeeze-和torch-unsqueeze-的用法"><a href="#torch-squeeze-和torch-unsqueeze-的用法" class="headerlink" title="torch.squeeze() 和torch.unsqueeze()的用法"></a>torch.squeeze() 和torch.unsqueeze()的用法</h2><ul>
<li><p>torch.squeeze() 这个函数主要对数据的维度进行压缩，去掉维数为1的的维度，比如是一行或者一列这种，一个一行三列（1,3）的数去掉第一个维数为一的维度之后就变成（3）行。squeeze(a)就是将a中所有为1的维度删掉。不为1的维度没有影响。a.squeeze(N) 就是去掉a中指定的维数为一的维度。还有一种形式就是b=torch.squeeze(a，N) a中去掉指定的定的维数为一的维度。</p>
</li>
<li><p>torch.unsqueeze()这个函数主要是对数据维度进行扩充。给指定位置加上维数为一的维度，比如原本有个三行的数据（3），在0的位置加了一维就变成一行三列（1,3）。a.squeeze(N) 就是在a中指定位置N加上一个维数为1的维度。还有一种形式就是b=torch.squeeze(a，N) a就是在a中指定位置N加上一个维数为1的维度</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/03/Swin-Transforemer%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/03/Swin-Transforemer%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">Swin-Transforemer网络</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-03 20:32:18 / 修改时间：20:36:29" itemprop="dateCreated datePublished" datetime="2021-08-03T20:32:18+08:00">2021-08-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">神经网络</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Swin-Transforemer网络基本学习版本一"><a href="#Swin-Transforemer网络基本学习版本一" class="headerlink" title="Swin-Transforemer网络基本学习版本一"></a>Swin-Transforemer网络基本学习版本一</h1><pre><code>import torch
import torch.nn as nn
import torch.utils.data as Data
import torchvision
import matplotlib.pyplot as plt
import time
import cv2.cv2 as cv2
import numpy as np
from einops import rearrange
from einops.layers.torch import Rearrange, Reduce
from torch.functional import einsum
plt.rcParams[&#39;font.family&#39;]=[&#39;SimHei&#39;]

#相对位置编码
def get_relative_distances(window_size):
    indices = torch.tensor(np.array([[x, y] for x in range(window_size) for y in range(window_size)]))
    distances = indices[None, :, :] - indices[:, None, :]
    return distances
#自注意力掩码创作
def create_mask(window_size, displacement, upper_lower, left_right):
    if upper_lower:
        mask = torch.zeros(window_size ** 2, window_size ** 2)
        mask[-displacement * window_size:, :-displacement * window_size] = float(&#39;-inf&#39;)
        mask[:-displacement * window_size, -displacement * window_size:] = float(&#39;-inf&#39;)
    else:
        mask = torch.zeros(window_size ** 2, window_size ** 2)
        mask = rearrange(mask, &#39;(h1 w1) (h2 w2) -&gt; h1 w1 h2 w2&#39;, h1=window_size, h2=window_size)
        mask[:, -displacement:, :, :-displacement] = float(&#39;-inf&#39;)
        mask[:, :-displacement, :, -displacement:] = float(&#39;-inf&#39;)
        mask = rearrange(mask, &#39;h1 w1 h2 w2 -&gt; (h1 w1) (h2 w2)&#39;)
    return mask

#降采样，类似于CNN中Pooling层#块合并
class PatchMerging(nn.Module):
    def __init__(self, in_channels, out_channels, downscaling_factor):
        super().__init__()
        self.downscaling_factor = downscaling_factor
        #在图像处理领域，经常需要用到卷积操作，但是有时我们只需要在图片上进行滑动的窗口操作，将图片切割成patch，而不需要进行卷积核和图片值的卷积乘法操作,Unfold
        self.patch_merge = nn.Unfold(kernel_size=downscaling_factor, stride=downscaling_factor, padding=0)
        self.linear = nn.Linear(in_channels * downscaling_factor ** 2, out_channels)

    def forward(self, x):
        b, c, h, w = x.shape
        new_h, new_w = h // self.downscaling_factor, w // self.downscaling_factor
        x = self.patch_merge(x) # (1, 48, 3136)  3136=56*56
        x = x.view(b, -1, new_h, new_w).permute(0, 2, 3, 1) # (1, 56, 56, 48)
        x = self.linear(x) # (1, 56, 56, 96) 
        return x
# 窗口变换
class CyclicShift(nn.Module):
    def __init__(self, displacement):
        super().__init__()
        # displacement的值是窗口值除2。
        self.displacement = displacement 

    def forward(self, x):
        #对数据进行滚动,维度1（行）向下（正数）滚动displacement位，维度2（列）向右（正数）滚动displacement位，
        return torch.roll(x, shifts=(self.displacement, self.displacement), dims=(1, 2))
#窗口注意力机制
class WindowAttention(nn.Module):
    def __init__(self, dim, heads, head_dim, shifted, window_size, relative_pos_embedding):
        super().__init__()
        inner_dim = head_dim * heads
        self.heads = heads
        self.scale = head_dim ** -0.5
        self.window_size = window_size
        self.relative_pos_embedding = relative_pos_embedding # (13, 13)
        self.shifted = shifted

        if self.shifted:
            displacement = window_size // 2
            self.cyclic_shift = CyclicShift(-displacement)
            self.cyclic_back_shift = CyclicShift(displacement)
            self.upper_lower_mask = nn.Parameter(
                create_mask(window_size=window_size, displacement=displacement, upper_lower=True, left_right=False), 
                requires_grad=False) # (49, 49)
            self.left_right_mask = nn.Parameter(
                create_mask(window_size=window_size, displacement=displacement,upper_lower=False, left_right=True), 
                requires_grad=False) # (49, 49)

        self.to_qkv = nn.Linear(dim, inner_dim * 3, bias=False)
        if self.relative_pos_embedding:
            self.relative_indices = get_relative_distances(window_size) + window_size - 1
            self.pos_embedding = nn.Parameter(torch.randn(2 * window_size - 1, 2 * window_size - 1))
        else:
            self.pos_embedding = nn.Parameter(torch.randn(window_size ** 2, window_size ** 2))

        self.to_out = nn.Linear(inner_dim, dim)

    def forward(self, x):
        if self.shifted:
            x = self.cyclic_shift(x)

        b, n_h, n_w, _, h = *x.shape, self.heads # [1, 56, 56, _, 3]
        qkv = self.to_qkv(x).chunk(3, dim=-1) # [(1,56,56,96), (1,56,56,96), (1,56,56,96)]
        nw_h = n_h // self.window_size # 8
        nw_w = n_w // self.window_size # 8
        # 分成 h/M * w/M 个窗口
        q, k, v = map( lambda t: rearrange(t, &#39;b (nw_h w_h) (nw_w w_w) (h d) -&gt; b h (nw_h nw_w) (w_h w_w) d&#39;, h=h, w_h=self.window_size, w_w=self.window_size), qkv)
        # q, k, v : (1, 3, 64, 49, 32)
        # 按窗口个数的self-attention
        dots = einsum(&#39;b h w i d, b h w j d -&gt; b h w i j&#39;, q, k) * self.scale # (1,3,64,49,49)

        if self.relative_pos_embedding:
            dots += self.pos_embedding[self.relative_indices[:, :, 0], self.relative_indices[:, :, 1]]
        else:
            dots += self.pos_embedding

        if self.shifted:
            dots[:, :, -nw_w:] += self.upper_lower_mask
            dots[:, :, nw_w - 1::nw_w] += self.left_right_mask

        attn = dots.softmax(dim=-1) # (1,3,64,49,49)
        out = einsum(&#39;b h w i j, b h w j d -&gt; b h w i d&#39;, attn, v)
        out = rearrange(out, &#39;b h (nw_h nw_w) (w_h w_w) d -&gt; b (nw_h w_h) (nw_w w_w) (h d)&#39;, h=h, w_h=self.window_size, w_w=self.window_size, nw_h=nw_h, nw_w=nw_w) # (1, 56, 56, 96) # 窗口合并
        out = self.to_out(out)
        if self.shifted:
            out = self.cyclic_back_shift(out)
        return out
#残差连接
class Residual(nn.Module):
    def __init__(self, fn):
        super().__init__()
        self.fn = fn

    def forward(self, x, **kwargs):
        return self.fn(x, **kwargs) + x
#归一化
class PreNorm(nn.Module):
    def __init__(self, dim, fn):
        super().__init__()
        self.norm = nn.LayerNorm(dim)
        self.fn = fn

    def forward(self, x, **kwargs):
        return self.fn(self.norm(x), **kwargs)
#全连接
class FeedForward(nn.Module):
    def __init__(self, dim, hidden_dim):
        super().__init__()
        input_dim = dim
        output_dim = hidden_dim 

        self.mlp = nn.Sequential(
            nn.Linear(input_dim, 4 * input_dim),
            nn.GELU(),
            nn.Linear(4 * input_dim, output_dim),
        )

    def forward(self, x):
        x =mlp(x)
        return x
#基础注意力机制模块
class SwinBlock(nn.Module):
    def __init__(self, dim, heads, head_dim, mlp_dim, shifted, window_size, relative_pos_embedding):
        super().__init__()
        self.attention_block = Residual(PreNorm(dim, WindowAttention(dim=dim, heads=heads, head_dim=head_dim, shifted=shifted, window_size=window_size, relative_pos_embedding=relative_pos_embedding)))
        self.mlp_block = Residual(PreNorm(dim, FeedForward(dim=dim, hidden_dim=mlp_dim)))

    def forward(self, x):
        x = self.attention_block(x)
        x = self.mlp_block(x)
        return x

#Swin Transformer的一个stage可以看做由Patch Merging和Swin Transformer Block组成
class StageModule(nn.Module):  
    def __init__(
    self, 
    in_channels,
    hidden_dimension,
    layers, 
    downscaling_factor,
    num_heads, 
    head_dim, 
    window_size,
    relative_pos_embedding
    ):
        super().__init__()
        assert layers % 2 == 0, &#39;Stage layers need to be divisible by 2 for regular and shifted block.&#39;
            #Swin Transformer的层数要为2的整数倍，一层提供给W-MSA，一层提供给SW-MSA。
        self.patch_partition = PatchMerging(in_channels=in_channels, out_channels=hidden_dimension,
                                            downscaling_factor=downscaling_factor)

        self.layers = nn.ModuleList([])
        for _ in range(layers // 2):
            self.layers.append(nn.ModuleList([
                #W-MSA
                SwinBlock(dim=hidden_dimension, heads=num_heads, head_dim=head_dim, mlp_dim=hidden_dimension * 4,
                        shifted=False, window_size=window_size, relative_pos_embedding=relative_pos_embedding),
                #SW-MSA
                SwinBlock(dim=hidden_dimension, heads=num_heads, head_dim=head_dim, mlp_dim=hidden_dimension * 4,
                        shifted=True, window_size=window_size, relative_pos_embedding=relative_pos_embedding),
            ]))
    def forward(self, x):
        x = self.patch_partition(x)
        for regular_block, shifted_block in self.layers:
            x = regular_block(x)
            x = shifted_block(x)
        return x.permute(0, 3, 1, 2)

class SwinTransformer(nn.Module):
    def __init__(self, *, 
        hidden_dim, 
        layers, heads, channels=3, num_classes=1000, head_dim=32, window_size=7, downscaling_factors=(4, 2, 2, 2), relative_pos_embedding=True):
        super(SwinTransformer,self).__init__()

        self.stage1 = StageModule(
            in_channels=channels, #图片维度，常见为3维，RGB
            hidden_dimension=hidden_dim, # 隐藏层输出维度
            layers=layers[0], # W_MSA+SW_MSA 作为一个整体的个数
            downscaling_factor=downscaling_factors[0],#降采样的尺度downscaling_factors=(4, 2, 2, 2)
            num_heads=heads[0], #并行的head数目
            head_dim=head_dim, 
            window_size=window_size, #窗口大小，每个窗口包含7*7各patch
            relative_pos_embedding=relative_pos_embedding
            )
        self.stage2 = StageModule(in_channels=hidden_dim, hidden_dimension=hidden_dim * 2, layers=layers[1], downscaling_factor=downscaling_factors[1], num_heads=heads[1], head_dim=head_dim, window_size=window_size, relative_pos_embedding=relative_pos_embedding)
        self.stage3 = StageModule(in_channels=hidden_dim * 2, hidden_dimension=hidden_dim * 4, layers=layers[2], downscaling_factor=downscaling_factors[2], num_heads=heads[2], head_dim=head_dim, window_size=window_size, relative_pos_embedding=relative_pos_embedding)
        self.stage4 = StageModule(in_channels=hidden_dim * 4, hidden_dimension=hidden_dim * 8, layers=layers[3], downscaling_factor=downscaling_factors[3], num_heads=heads[3], head_dim=head_dim, window_size=window_size, relative_pos_embedding=relative_pos_embedding)

        self.mlp_head = nn.Sequential(
            nn.LayerNorm(hidden_dim * 8),
            nn.Linear(hidden_dim * 8, num_classes)
        )
    def forward(self, img):
        x = self.stage1(img)
        x = self.stage2(x)
        x = self.stage3(x)
        x = self.stage4(x) # (1, 768, 7, 7)
        x = x.mean(dim=[2, 3]) # (1,768)
        return self.mlp_head(x)

if __name__ == &#39;__main__&#39;:

    net = SwinTransformer(
        hidden_dim=96,
        layers=(2, 2, 6, 2),
        heads=(3, 6, 12, 24),
        channels=3,
        num_classes=2,
        head_dim=32,  #96/3
        window_size=7,
        downscaling_factors=(4, 2, 2, 2),
        relative_pos_embedding=True
    )

    print(net)</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/22/RegressionOfDL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/22/RegressionOfDL/" class="post-title-link" itemprop="url">RegressionOfDL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-22 17:13:12 / 修改时间：17:20:46" itemprop="dateCreated datePublished" datetime="2021-03-22T17:13:12+08:00">2021-03-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="深度学习之线性回归"><a href="#深度学习之线性回归" class="headerlink" title="深度学习之线性回归"></a>深度学习之线性回归</h1><h2 id="学习来自b站莫烦"><a href="#学习来自b站莫烦" class="headerlink" title="学习来自b站莫烦"></a>学习来自b站莫烦</h2><h3 id="代码注解如下"><a href="#代码注解如下" class="headerlink" title="代码注解如下"></a>代码注解如下</h3><pre><code>import torch
import torch.nn.functional as F     # 激励函数都在这
import matplotlib.pyplot as plt

class Net(torch.nn.Module):  # 继承 torch 的 Module
    def __init__(self, n_feature, n_hidden, n_output):
        super(Net, self).__init__()     # 继承 __init__ 功能
        # 定义每层用什么样的形式
        self.hidden = torch.nn.Linear(n_feature, n_hidden)   # 隐藏层线性输出
        self.predict = torch.nn.Linear(n_hidden, n_output)   # 输出层线性输出

    def forward(self, x):   # 这同时也是 Module 中的 forward 功能
        # 正向传播输入值, 神经网络分析出输出值
        x = F.relu(self.hidden(x))      # 激励函数(隐藏层的线性值)
        x = self.predict(x)             # 输出值
        return x

net = Net(n_feature=1, n_hidden=10, n_output=1)


x = torch.unsqueeze(torch.linspace(-1, 1, 100), dim=1)  # x data (tensor), shape=(100, 1)
y = x.pow(2) + 0.2*torch.rand(x.size())                 # noisy y data (tensor), shape=(100, 1)
# optimizer 是训练的工具
optimizer = torch.optim.SGD(net.parameters(), lr=0.5)  # 传入 net 的所有参数, 学习率
loss_func = torch.nn.MSELoss()      # 预测值和真实值的误差计算公式 (均方差)



# 实时画图
plt.ion()  
plt.show()

for t in range(200):

    prediction = net(x)     # 喂给 net 训练数据 x, 输出预测值
    loss = loss_func(prediction, y)     # 计算两者的误差
    optimizer.zero_grad()   # 清空上一步的残余更新参数值
    loss.backward()         # 误差反向传播, 计算参数更新值
    optimizer.step()        # 将参数更新值施加到 net 的 parameters 上

    # 接着上面来
    if  t % 5 == 0:
        # plot and show learning process
        plt.cla()
        plt.scatter(x.data.numpy(), y.data.numpy())
        plt.plot(x.data.numpy(), prediction.data.numpy(), &#39;r-&#39;, lw=5)
        plt.text(0.5, 0, &#39;Loss=%.4f&#39; % loss.data.numpy(), fontdict=&#123;&#39;size&#39;: 20, &#39;color&#39;:  &#39;red&#39;&#125;)
        plt.pause(0.1)
plt.ioff()
plt.show()</code></pre>
<img src="/2021/03/22/RegressionOfDL/Figure_1.png" class="" title="静态示001"> 
<img src="/2021/03/22/RegressionOfDL/Regression1-1.gif" class="" title="动态示001">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/19/Numpy%E5%90%8CTorch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/19/Numpy%E5%90%8CTorch/" class="post-title-link" itemprop="url">Numpy同Torch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-19 20:54:39" itemprop="dateCreated datePublished" datetime="2021-03-19T20:54:39+08:00">2021-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-22 17:26:12" itemprop="dateModified" datetime="2021-03-22T17:26:12+08:00">2021-03-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="代码注解如下"><a href="#代码注解如下" class="headerlink" title="代码注解如下"></a>代码注解如下</h1><pre><code>import torch
import numpy as np

np_data=np.arange(6).reshape((2,3))
print(&quot;数据numpy_data: \n &#123;&#125;\n&quot;.format(np_data))
torch_data=torch.from_numpy(np_data)
print(&quot;数据torch_data: \n &#123;&#125;\n&quot;.format(torch_data))

torch2array=torch_data.numpy()
print(&quot;数据torch2array: \n &#123;&#125;\n&quot;.format(torch2array))

#abs sin mean
data=[-1,-2,-2,1,2]
tensor=torch.FloatTensor(data)
print(&quot;abs时数据: \n &#123;&#125;\n&quot;.format(np.abs(data)))
print(&quot;abs时数据: \n &#123;&#125;\n&quot;.format(torch.abs(tensor)))

#矩阵运算
data001=[[1,2],[3,4]]
data001=np.array(data001)
tensor001=torch.FloatTensor(data001)
#乘法
print(&quot;矩阵乘法时数据: \n &#123;&#125;\n&quot;.format(np.matmul(data001,data001)))
print(&quot;矩阵乘法时数据: \n &#123;&#125;\n&quot;.format(torch.mm(tensor001,tensor001)))</code></pre>
<img src="/2021/03/19/Numpy%E5%90%8CTorch/torch001.PNG" class="" title="结果展示"> 
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">pandas数据结构学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-18 16:18:33 / 修改时间：20:39:01" itemprop="dateCreated datePublished" datetime="2021-03-18T16:18:33+08:00">2021-03-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pandas基本学习"><a href="#pandas基本学习" class="headerlink" title="pandas基本学习"></a>pandas基本学习</h1><h2 id="引入pandas包-，同时引入numpy"><a href="#引入pandas包-，同时引入numpy" class="headerlink" title="引入pandas包 ，同时引入numpy"></a>引入pandas包 ，同时引入numpy</h2><pre><code>import pandas as pd
import numpy as np</code></pre>
<h3 id="用值列表生成-Series时，Pandas-默认自动生成整数索引"><a href="#用值列表生成-Series时，Pandas-默认自动生成整数索引" class="headerlink" title="用值列表生成 Series时，Pandas 默认自动生成整数索引"></a>用值列表生成 Series时，Pandas 默认自动生成整数索引</h3><pre><code>a=pd.Series([1,2,3,4,5,np.nan,9])
print(&quot;pandas数组a: \n&#123;&#125;\n&quot;.format(a))</code></pre>
<img src="/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/pandas101.PNG" class="" title="展示001"> 

<h3 id="用含日期时间索引与标签的-NumPy-数组生成-DataFrame"><a href="#用含日期时间索引与标签的-NumPy-数组生成-DataFrame" class="headerlink" title="用含日期时间索引与标签的 NumPy 数组生成 DataFrame"></a>用含日期时间索引与标签的 NumPy 数组生成 DataFrame</h3><pre><code>dates=pd.date_range(&quot;20210318&quot;, periods=8)
print(&quot;pandas数组dates: \n&#123;&#125;\n&quot;.format(dates))
df=pd.DataFrame(np.random.randn(8,4),index=dates, columns=list(&#39;ABCD&#39;))
print(&quot;pandas数组df: \n&#123;&#125;\n&quot;.format(df))</code></pre>
<img src="/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/pandas102.PNG" class="" title="展示002"> 

<h3 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h3><pre><code>print(&quot;pandas中DataFrame类型: \n&#123;&#125;\n&quot;.format(df.dtypes))
print(&quot;pandas中df索引: \n&#123;&#125;\n&quot;.format(df.index))
print(&quot;pandas中df列名: \n&#123;&#125;\n&quot;.format(df.columns))
#describe()可以快速查看数据的统计摘要：
print(&quot;pandas中df统计摘要: \n&#123;&#125;\n&quot;.format(df.describe()))</code></pre>
<img src="/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/pandas103.PNG" class="" title="原图003"> 

<img src="/2021/03/18/pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/pandas104.PNG" class="" title="原图004"> 
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/09/opencv%E4%B9%8B%E9%98%88%E5%80%BC%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/09/opencv%E4%B9%8B%E9%98%88%E5%80%BC%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">opencv之阈值处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-09 20:45:19" itemprop="dateCreated datePublished" datetime="2020-10-09T20:45:19+08:00">2020-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-18 16:38:43" itemprop="dateModified" datetime="2021-03-18T16:38:43+08:00">2021-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/opencv/" itemprop="url" rel="index"><span itemprop="name">opencv</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="阈值处理："><a href="#阈值处理：" class="headerlink" title="阈值处理："></a>阈值处理：</h1><pre><code>是指剔除图像内像素值高于一定值或低于一定值的像素值</code></pre>
<h2 id="具体编码："><a href="#具体编码：" class="headerlink" title="具体编码："></a>具体编码：</h2><pre><code>#固定阈值分割很直接，一句话说就是像素点值大于阈值变成一类值，小于阈值变成另一类值。
import matplotlib.pyplot as plt
import cv2
img=cv2.imread(r&quot;E:\vscode\python\text\pic\100sh.jpg&quot;,0)

# 应用5种不同的阈值方法
ret1, th1 = cv2.threshold(img, 127, 255, cv2.THRESH_BINARY)#大于阈值的部分被置为255，小于部分被置为0 
ret2, th2 = cv2.threshold(img, 127, 255, cv2.THRESH_BINARY_INV)
ret3, th3 = cv2.threshold(img, 127, 255, cv2.THRESH_TRUNC)
ret4, th4 = cv2.threshold(img, 127, 255, cv2.THRESH_TOZERO)
ret5, th5 = cv2.threshold(img, 127, 255, cv2.THRESH_TOZERO_INV)
#图像自适应二值化的一个很优的算法Otsu大津算法的参数：
ret6, th6 = cv2.threshold(img, 0, 255, cv2.THRESH_OTSU)
print(ret6)
#自适应阈值
th7=cv2.adaptiveThreshold(img, 255, cv2.ADAPTIVE_THRESH_MEAN_C, cv2.THRESH_BINARY,5,3)
th8=cv2.adaptiveThreshold(img, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY,5,3)


titles = [&#39;Original&#39;, &#39;BINARY&#39;, &#39;BINARY_INV&#39;, &#39;TRUNC&#39;, &#39;TOZERO&#39;, &#39;TOZERO_INV&#39;, &quot;OTSU&quot;,&quot;adaptive_MEAN&quot;,&quot;adaptive_GAUSSIAN&quot;]
images = [img, th1, th2, th3, th4, th5,th6,th7,th8]

# 使用Matplotlib显示
for i in range(len(images)):
    plt.subplot(3, 3, i + 1)
    plt.imshow(images[i], &#39;gray&#39;)
    plt.title(titles[i], fontsize=8)
    plt.xticks([]), plt.yticks([])  # 隐藏坐标轴

plt.show()</code></pre>
<h2 id="操作效果展示："><a href="#操作效果展示：" class="headerlink" title="操作效果展示："></a>操作效果展示：</h2><img src="/2020/10/09/opencv%E4%B9%8B%E9%98%88%E5%80%BC%E5%A4%84%E7%90%86/opencv6_1.png" class="" title="阈值处理效果展示">  

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/08/opencv%E4%B9%8B%E5%9B%BE%E7%89%87%E6%98%A0%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/08/opencv%E4%B9%8B%E5%9B%BE%E7%89%87%E6%98%A0%E5%B0%84/" class="post-title-link" itemprop="url">opencv之图片仿射</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-08 23:04:05" itemprop="dateCreated datePublished" datetime="2020-10-08T23:04:05+08:00">2020-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-18 16:38:24" itemprop="dateModified" datetime="2021-03-18T16:38:24+08:00">2021-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/opencv/" itemprop="url" rel="index"><span itemprop="name">opencv</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="图片仿射"><a href="#图片仿射" class="headerlink" title="图片仿射"></a>图片仿射</h1><h2 id="仿射函数介绍："><a href="#仿射函数介绍：" class="headerlink" title="仿射函数介绍："></a>仿射函数介绍：</h2><ul>
<li><p>平移参数：原图，变换的2*3矩阵，大小</p>
<pre><code>  cv2.warpAffine(img,M,(width,height))</code></pre>
</li>
<li><p>旋转，重点获得转换矩阵,参数：旋转中心点，旋转角度，变换尺度</p>
<pre><code>  retval=cv2.getRotationMatrix2D((height/2,width/2),45,0.6)#旋转矩阵
  rotate=cv2.warpAffine(img,retval,(width,height))</code></pre>
</li>
<li><p>更复杂的仿射：（点，前列后宽）</p>
<pre><code>  p1=np.float32([[0,0],[width-1,0],[0,height-1]])
  p2=np.float32([[0,width*0.33],[width*0.85,height*0.25],[width*0.15,height*0.7]])
  retval001=cv2.getAffineTransform(p1,p2)</code></pre>
</li>
</ul>
<h2 id="具体编码："><a href="#具体编码：" class="headerlink" title="具体编码："></a>具体编码：</h2><pre><code>import cv2
import numpy as np
import matplotlib.pyplot as plt
#仿射
img=cv2.imread(r&quot;E:\vscode\python\text\pic\100sh.jpg&quot;)
img=cv2.cvtColor(img,cv2.COLOR_BGR2RGB)

height,width,ch=img.shape
x=100
y=200
#定义一个2*3矩阵
M=np.float32([[1,0,x],[0,1,y]])
#平移参数：原图，变换矩阵，大小
move=cv2.warpAffine(img,M,(width,height))
#旋转，重点获得转换矩阵,参数：旋转中心点，旋转角度，变换尺度
retval=cv2.getRotationMatrix2D((height/2,width/2),45,0.6)
print(retval)
rotate=cv2.warpAffine(img,retval,(width,height))
#更复杂的映射
#点，前列后宽
p1=np.float32([[0,0],[width-1,0],[0,height-1]])
p2=np.float32([[0,width*0.33],[width*0.85,height*0.25],[width*0.15,height*0.7]])
retval001=cv2.getAffineTransform(p1,p2)
print(retval001)
dst=cv2.warpAffine(img,retval001,(width,height))

title=[&quot;原图RGB&quot;,&quot;平移&quot;,&quot;旋转&quot;,&quot;复杂的仿射&quot;]
imgs=[img,move,rotate,dst]
plt.figure()
plt.rcParams[&#39;font.family&#39;]=[&#39;SimHei&#39;]
for i in range(1,len(imgs)+1):
    plt.subplot(1,4,i)
    #if(np.max(imgs[i-1]) is not None):
    plt.imshow(imgs[i-1])
    plt.title(title[i-1])
    plt.xticks([])
    plt.yticks([])
plt.show()</code></pre>
<h2 id="操作效果展示："><a href="#操作效果展示：" class="headerlink" title="操作效果展示："></a>操作效果展示：</h2><img src="/2020/10/08/opencv%E4%B9%8B%E5%9B%BE%E7%89%87%E6%98%A0%E5%B0%84/opencv5_2.png" class="" title="映射效果展示">  

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/07/opencv%E4%B9%8B%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%BD%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/07/opencv%E4%B9%8B%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%BD%AC/" class="post-title-link" itemprop="url">opencv之图像翻转</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-07 21:59:08" itemprop="dateCreated datePublished" datetime="2020-10-07T21:59:08+08:00">2020-10-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-18 16:38:30" itemprop="dateModified" datetime="2021-03-18T16:38:30+08:00">2021-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/opencv/" itemprop="url" rel="index"><span itemprop="name">opencv</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简单图片翻转"><a href="#简单图片翻转" class="headerlink" title="简单图片翻转"></a>简单图片翻转</h1><h2 id="图片翻转原图："><a href="#图片翻转原图：" class="headerlink" title="图片翻转原图："></a>图片翻转原图：</h2><img src="/2020/10/07/opencv%E4%B9%8B%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%BD%AC/100sh.jpg" class="" title="原图展示"> 

<h2 id="翻转函数介绍："><a href="#翻转函数介绍：" class="headerlink" title="翻转函数介绍："></a>翻转函数介绍：</h2><pre><code>cv.flip(img,figure)</code></pre>
<p>figure值的含义：</p>
<ul>
<li>0代表x轴翻转</li>
<li>正数y轴翻转</li>
<li>负数xy翻转</li>
</ul>
<h2 id="具体编码："><a href="#具体编码：" class="headerlink" title="具体编码："></a>具体编码：</h2><pre><code>import cv2
import numpy as np
import matplotlib.pyplot as plt


#图片翻转
img=cv2.imread(r&quot;E:\vscode\python\text\pic\100sh.jpg&quot;)
x=cv2.flip(img,0)#0代表x轴翻转
y=cv2.flip(img,1)#正数y轴翻转
xy=cv2.flip(img,-1)#负数xy翻转
#plt中文使用
plt.rcParams[&#39;font.family&#39;]=[&#39;SimHei&#39;]
title=[&quot;原图BGR&quot;,&quot;x轴翻转&quot;,&quot;y轴翻转&quot;,&quot;xy翻转&quot;]
imgs=[img,x,y,xy]
plt.figure()
for i in range(1,5):
    plt.subplot(2,2,i)
    plt.imshow(imgs[i-1])
    plt.title(title[i-1])
    plt.xticks([])
    plt.yticks([])
plt.show()</code></pre>
<h2 id="操作效果展示："><a href="#操作效果展示：" class="headerlink" title="操作效果展示："></a>操作效果展示：</h2> <img src="/2020/10/07/opencv%E4%B9%8B%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%BD%AC/opencv5_1.png" class="" title="翻转效果展示">  
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/29/HSV%E9%A2%9C%E8%89%B2%E6%8F%90%E5%8F%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/002.jpg">
      <meta itemprop="name" content="蒲建飞">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海盗船长的领域">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/29/HSV%E9%A2%9C%E8%89%B2%E6%8F%90%E5%8F%96/" class="post-title-link" itemprop="url">HSV颜色提取</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-29 21:18:52" itemprop="dateCreated datePublished" datetime="2020-09-29T21:18:52+08:00">2020-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-18 16:38:18" itemprop="dateModified" datetime="2021-03-18T16:38:18+08:00">2021-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/opencv/" itemprop="url" rel="index"><span itemprop="name">opencv</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="HSV颜色提取图形步骤："><a href="#HSV颜色提取图形步骤：" class="headerlink" title="HSV颜色提取图形步骤："></a>HSV颜色提取图形步骤：</h1><h2 id="下面以提取图片中蓝色形状物为例："><a href="#下面以提取图片中蓝色形状物为例：" class="headerlink" title="下面以提取图片中蓝色形状物为例："></a>下面以提取图片中蓝色形状物为例：</h2> <img src="/2020/09/29/HSV%E9%A2%9C%E8%89%B2%E6%8F%90%E5%8F%96/opencv.png" class="" title="原图展示">  


<ul>
<li><p>获取指定颜色HSV值，以蓝色为例： </p>
<p>  blue = np.uint8([[[255, 0, 0]]])</p>
<p>  hsv_blue = cv2.cvtColor(blue, cv2.COLOR_BGR2HSV)</p>
<p>  print(hsv_blue)  # [[[120 255 255]]]</p>
</li>
<li><p>通过inRange()锁定特定值</p>
</li>
<li><p>基于掩码的按位与显示ROI</p>
</li>
<li><p>显示特定颜色值</p>
</li>
</ul>
<p>具体编码如下：</p>
<pre><code>import cv2
import matplotlib.pyplot as plt
import numpy as np
img=cv2.imread(r&quot;E:\vscode\python\text\pic\opencv.png&quot;)
hsv=cv2.cvtColor(img,cv2.COLOR_BGR2HSV)
minBlue=np.array([110,110,110])
maxBlue=np.array([130,255,255])
#蓝色区域,inRange()主要是将在两个阈值内的像素值设置为白色（255），而不在阈值区间内的像素值设置为黑色（0）
maskB=cv2.inRange(hsv,minBlue,maxBlue)
#掩膜控制蓝色区域，img+img在与maskB与运算，白（全1）透黑（全0）不透
blue=cv2.bitwise_and(img,img,mask=maskB)
#将BGR的蓝色图像转换为RGB
blue=cv2.cvtColor(blue,cv2.COLOR_BGR2RGB)

title=[&quot;原图BGR&quot;,&quot;hsv&quot;,&quot;mask&quot;,&quot;blue&quot;]
imgs=[img,hsv,maskB,blue]
plt.rcParams[&#39;font.family&#39;]=[&#39;SimHei&#39;]
plt.figure()
for i in range(1,len(imgs)+1):
    plt.subplot(2,2,i)
    #if(np.max(imgs[i-1]) is not None):
    plt.imshow(imgs[i-1])
    plt.title(title[i-1])
    plt.xticks([])
    plt.yticks([])
plt.show()</code></pre>
<h2 id="操作效果展示："><a href="#操作效果展示：" class="headerlink" title="操作效果展示："></a>操作效果展示：</h2> <img src="/2020/09/29/HSV%E9%A2%9C%E8%89%B2%E6%8F%90%E5%8F%96/HSV001.png" class="" title="HSV效果展示">  




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蒲建飞"
      src="/images/002.jpg">
  <p class="site-author-name" itemprop="name">蒲建飞</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/paulJFei" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;paulJFei" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蒲建飞</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
